"use strict";loader.define(function(e,t,a){var d={name:"历史数据",request:null,loading:null,deviceer:null,deviceor:null,signaler:null,starter:null,ender:null,submit:null,nodes:null};function u(e){!0!==isNull(e)?(d.loading.show(),getAllSignalsByPid(e,null,function(e){i(e)},function(e){warning(e.message)},function(){d.loading.hide()})):i([])}function i(e){var a=[],i=[];$.each(e,function(e,t){t.Type!==$node.AI.id&&t.Type!==$node.DI.id||(i.push(t),a.push({name:t.Name,value:t.ID}))}),d.nodes=i,d.signaler.option("data",a),d.signaler.selectNone()}function n(e){var t=d.signaler.value();if(!0===isNullOrEmpty(t))return warning("请选择信号哦"),e.stop(),!1;var a=parseInt(t),i=d.nodes.filter(function(e){return e.ID===a});if(i.length<=0)return warning("无效的信号~"),e.stop(),!1;var n=d.starter.value(),l=d.ender.value();return!0===isNullOrEmpty(n)?(warning("请选择开始时间"),e.stop(),!1):!0===isNullOrEmpty(l)?(warning("请选择结束时间"),e.stop(),!1):(e.stop(),void router.load({url:"pages/main/datadetail.html",param:{id:i[0].ID,name:i[0].Name,type:i[0].Type,desc:i[0].ValueDesc,begin:n,end:l}}))}return d.init=function(){!0===isNull(this.request)&&(this.request=getAppRequest()),!0===isNull(this.loading)&&(this.loading=bui.loading({appendTo:".datareport-page",text:"正在加载"})),!0===isNull(this.deviceer)&&(d.loading.show(),getXDevices(null,function(e){!function(e){if(getAppAuthType()===$ssh.Station){for(var t=getStations(),i=[],n={},a=0;a<t.length;a++){var l=t[a];n[l.ID]={d:l.ID,n:l.Name,c:[]}}$.each(e,function(e,t){var a=n[t.PID];a&&a.c.push({d:t.ID,n:t.Name})}),$.each(t,function(e,t){var a=n[t.ID];a&&i.push(a)}),router.$("#pylon-app-datareport-deviceer .selector").html('<div class="selected-val"></div><div class="selected-val"></div>'),d.deviceer=bui.levelselect({data:i,title:"筛选范围",trigger:"#pylon-app-datareport-deviceer .selected-val",level:2,field:{name:"n",value:"d",data:["c","a"]}})}else{var r=getAreas(),s=(t=getStations(),i=[],{});for(n={},a=0;a<r.length;a++){l=r[a];s[l.ID]={d:l.ID,n:l.Name,c:[]}}for(a=0;a<t.length;a++){l=t[a];n[l.ID]={d:l.ID,n:l.Name,c:[]}}$.each(e,function(e,t){var a=n[t.PID];a&&a.c.push({d:t.ID,n:t.Name})}),$.each(t,function(e,t){var a=s[t.PID];a&&a.c.push(n[t.ID])}),$.each(r,function(e,t){var a=s[t.ID];a&&i.push(a)}),router.$("#pylon-app-datareport-deviceer .selector").html('<div class="selected-val"></div><div class="selected-val"></div><div class="selected-val"></div>'),d.deviceer=bui.levelselect({data:i,title:"筛选范围",trigger:"#pylon-app-datareport-deviceer .selected-val",level:3,field:{name:"n",value:"d",data:["c","a"]}})}!1===isNull(d.deviceer)&&d.deviceer.on("lastchange",function(e,t,a){var i=this.value();if(getAppAuthType()===$ssh.Station){if(2<=i.length)return u(parseInt(i[1].value)),!0}else if(3<=i.length)return u(parseInt(i[2].value)),!0;u()})}(e)},function(e){warning(e.message)},function(){d.loading.hide()})),!0===isNull(this.deviceor)&&(this.deviceor=router.$("#pylon-app-datareport-deviceer"),this.deviceor.on("click",function(){d.deviceer.show()})),!0===isNull(this.signaler)&&(this.nodes=[],this.signaler=bui.select({trigger:"#pylon-app-datareport-signal",title:"信号列表",type:"radio",height:"60%",autoClose:!0,data:[],placeholder:"请选择"})),!0===isNull(this.starter)&&(this.starter=bui.pickerdate({bindValue:!0,handle:"#pylon-app-datareport-start",formatValue:"yyyy-MM-dd hh:mm:ss",value:bui.date.format(new Date,"yyyy-MM-dd")})),!0===isNull(this.ender)&&(this.ender=bui.pickerdate({bindValue:!0,handle:"#pylon-app-datareport-end",formatValue:"yyyy-MM-dd hh:mm:ss",value:new Date})),!0===isNull(this.submit)&&(this.submit=bui.btn("#pylon-app-datareport-ok"),this.submit.submit(n,{text:"正在查询..."}))},d.load=function(){},d.dispose=function(){},d.init(),d});
"use strict";loader.define(function(n,a,e){var i={name:"数据机房监控系统",request:null,maintab:null,loading:null,timer:null,params:null,increment:0};function t(n,a,e){loadData(function(){i.loading.show()},n,a,function(){i.loading.hide(),!0===isFunction(e)&&e()})}function o(n){i.timer=setTimeout(function(){i.message()},n||1e4)}function u(){!1===isNull(i.timer)&&(clearTimeout(i.timer),i.timer=null)}function r(n,a){router.$("#pylon-app-main-alarm").html(!0===n?"":String.format('<span class="bui-badges">{0}</span>',function(n){if(!0===isNull(n))return"";if(n<=0)return"";if(99<n)return"99+";return n.toString()}(a)))}function s(){loader.require(["pages/main/home"],function(n){})}return i.init=function(){!0===isNull(this.request)&&(this.request=getAppRequest()),!0===isNull(this.loading)&&(this.loading=bui.loading({appendTo:".main-page",text:"正在加载"})),!0===isNull(this.maintab)&&(this.maintab=bui.tab({id:"#app-main-tab-container",menu:"#app-main-tab-nav",animate:!1,swipe:!1,autoload:!0,onBeforeTo:function(n){switch(n.prevIndex){case 0:loader.require(["pages/main/home"],function(n){n.dispose()});break;case 1:loader.require(["pages/main/data"],function(n){n.dispose()});break;case 2:loader.require(["pages/main/alarm"],function(n){n.dispose()});break;case 3:loader.require(["pages/main/user"],function(n){n.dispose()})}}}),this.maintab.on("to",function(n){switch(n){case 0:s();break;case 1:loader.require(["pages/main/data"],function(n){n.load()});break;case 2:r(!0),i.increment=0,loader.require(["pages/main/alarm"],function(n){!1===isNull(i.params)&&(n.condition(i.params.data),!0===i.params.once&&(i.params=null)),n.load()});break;case 3:loader.require(["pages/main/user"],function(n){n.load()})}}))},i.load=function(){if(null==this.request)return!1;u(),r(!0),t(function(n){o(200),s()},function(n){warning(n)})},i.refresh=function(a,e,n){u(),r(!0),t(function(n){o(200),a(n)},function(n){e(n)},n)},i.dispose=function(){this.totab(0,"none"),this.params=null,u()},i.message=function(){this.request.Post({url:"GetRealMessage"},function(n){var a=n.data.TotalCountor;!1===isNull(a)&&loader.require(["pages/main/home"],function(n){n.load({level1:a.AL1Count,level2:a.AL2Count,level3:a.AL3Count,level4:a.AL4Count})}),2!==i.maintab.index()&&(i.increment+=n.data.NewAlarmNumber,r(i.increment<=0))},function(n){},function(){u(),o()})},i.totab=function(n,a){!0===isNull(a)?this.maintab.to(n):this.maintab.to(n,a)},i.setparams=function(n){!1===isNull(n)?this.params=n:this.params=null},i.init(),i.load(),i});
"use strict";loader.define(function(e,l,a){var u={name:"实时告警",request:null,sidebar:null,pull:null,select:null,menubtn:null,resetbtn:null,okbtn:null,choose:null,timer:null,options:null};function n(){!1===isNull(u.timer)&&(clearTimeout(u.timer),u.timer=null)}function t(){var e=router.$("#pylon-app-alarm-level1"),l=router.$("#pylon-app-alarm-level2"),a=router.$("#pylon-app-alarm-level3"),n=router.$("#pylon-app-alarm-level4"),t=router.$("#pylon-app-alarm-signal"),i=u.select;return e.prop("checked",!1),l.prop("checked",!1),a.prop("checked",!1),n.prop("checked",!1),t.val(""),getAppAuthType()===$ssh.Station?i.value([{value:s()},{value:s()}]):i.value([{value:s()},{value:s()},{value:s()}]),u.condition(),{select:i,signal:t,level1:e,level2:l,level3:a,level4:n}}function p(e){return{area:null==(e=e||u.options).area?null:[e.area.name],station:null==e.station?null:[e.station.name],device:null==e.device?null:[e.device.name],signal:null==e.signal?null:[String.format("%{0}%",e.signal)],alarmLevel:e.level}}function s(e){return!0===isNull(e)?"-1":e.id.toString()}function i(){router.$("#pylon-app-alarm-list").html(""),router.$(".overlist .bui-scroll-foot").html('<div class="nodata"><i class="appiconfont appicon-empty-face"></i> <span>列表空空如也~</span></div>')}return u.init=function(){var e,l;!0===isNull(this.request)&&(this.request=getAppRequest()),!0===isNull(this.sidebar)&&(this.sidebar=bui.sidebar({id:"#app-main-tab-alarm",handle:".alarm-page",width:640}),this.sidebar.lock()),!0===isNull(this.menubtn)&&(this.menubtn=$("#pylon-app-alarm-menu"),this.menubtn.on("click",function(){!function(e){var a=t();$.each(e.level,function(e,l){switch(l){case $level.L1:a.level1.prop("checked",!0);break;case $level.L2:a.level2.prop("checked",!0);break;case $level.L3:a.level3.prop("checked",!0);break;case $level.L4:a.level4.prop("checked",!0)}}),!1===isNullOrEmpty(e.signal,!0)&&a.signal.val(e.signal);getAppAuthType()===$ssh.Station?a.select.value([{value:s(e.station)},{value:s(e.device)}]):a.select.value([{value:s(e.area)},{value:s(e.station)},{value:s(e.device)}]);u.options=e}(u.options),u.sidebar.open({target:"swipeleft"})})),!0===isNull(this.resetbtn)&&(this.resetbtn=$("#pylon-app-alarm-reset"),this.resetbtn.on("click",function(){t()})),!0===isNull(this.okbtn)&&(this.okbtn=$("#pylon-app-alarm-ok"),this.okbtn.on("click",function(){!function(){var e=router.$("#pylon-app-alarm-level1"),l=router.$("#pylon-app-alarm-level2"),a=router.$("#pylon-app-alarm-level3"),n=router.$("#pylon-app-alarm-level4"),t=router.$("#pylon-app-alarm-signal"),i=u.select,s={area:null,station:null,device:null,signal:null,level:[]};!0===e.is(":checked")&&s.level.push($level.L1);!0===l.is(":checked")&&s.level.push($level.L2);!0===a.is(":checked")&&s.level.push($level.L3);!0===n.is(":checked")&&s.level.push($level.L4);var c=t.val().trim();!1===isNullOrEmpty(c)&&(s.signal=c);var r=i.value();if(getAppAuthType()===$ssh.Station){if(1<=r.length)-1!==(o=parseInt(r[0].value))&&(s.station={id:o,name:r[0].name});if(2<=r.length)-1!==(o=parseInt(r[1].value))&&(s.device={id:o,name:r[1].name})}else{var o;if(1<=r.length)-1!==(o=parseInt(r[0].value))&&(s.area={id:o,name:r[0].name});if(2<=r.length)-1!==(o=parseInt(r[1].value))&&(s.station={id:o,name:r[1].name});if(3<=r.length)-1!==(o=parseInt(r[2].value))&&(s.device={id:o,name:r[2].name})}u.options=s,loader.require(["main"],function(e){e.setparams({once:!1,data:s})}),u.refresh(p(s),function(e){warning(e)})}(),u.sidebar.close()})),!0===isNull(this.pull)&&(this.pull=bui.pullrefresh({id:"#pylon-app-alarm-scroll",autoLoad:!1,onRefresh:function(){u.refresh(null,function(e){warning(e)},function(){u.pull.reverse()})}})),!0===isNull(this.select)&&getXDevices(null,function(e){!function(e){if(getAppAuthType()===$ssh.Station){for(var l=getStations(),n=[],t={},a=0;a<l.length;a++){var i=l[a];t[i.ID]={d:i.ID,n:i.Name,c:[{d:"-1",n:"全部"}]}}$.each(e,function(e,l){var a=t[l.PID];a&&a.c.push({d:l.ID,n:l.Name})}),n.push({d:"-1",n:"全部",c:[{d:"-1",n:"全部"}]}),$.each(l,function(e,l){var a=t[l.ID];a&&n.push(a)}),router.$("#pylon-app-alarm-deviceer .selector").html('<div class="selected-val"></div><div class="selected-val"></div>'),u.select=bui.levelselect({data:n,title:"筛选范围",trigger:"#pylon-app-alarm-deviceer .selected-val",level:2,field:{name:"n",value:"d",data:["c","a"]}})}else{var s=getAreas(),c=(l=getStations(),n=[],{});for(t={},a=0;a<s.length;a++){i=s[a];c[i.ID]={d:i.ID,n:i.Name,c:[{d:"-1",n:"全部",c:[{d:"-1",n:"全部"}]}]}}for(a=0;a<l.length;a++){i=l[a];t[i.ID]={d:i.ID,n:i.Name,c:[{d:"-1",n:"全部"}]}}$.each(e,function(e,l){var a=t[l.PID];a&&a.c.push({d:l.ID,n:l.Name})}),$.each(l,function(e,l){var a=c[l.PID];a&&a.c.push(t[l.ID])}),n.push({d:"-1",n:"全部",c:[{d:"-1",n:"全部",c:[{d:"-1",n:"全部"}]}]}),$.each(s,function(e,l){var a=c[l.ID];a&&n.push(a)}),router.$("#pylon-app-alarm-deviceer .selector").html('<div class="selected-val"></div><div class="selected-val"></div><div class="selected-val"></div>'),u.select=bui.levelselect({data:n,title:"筛选范围",trigger:"#pylon-app-alarm-deviceer .selected-val",level:3,field:{name:"n",value:"d",data:["c","a"]}})}}(e)},function(e){warning(e.message)}),!0===isNull(this.choose)&&(this.choose=$("#pylon-app-alarm-deviceer"),this.choose.on("click",function(){!1===isNull(u.select)&&u.select.show()})),!0===isNull(this.options)&&this.condition(),e=router.$("#app-main-tab-alarm"),l=e.parent(),e.height(l.height())},u.load=function(){this.sidebar.isActive()&&this.sidebar.close(),function e(l){u.timer=setTimeout(function(){u.refresh(p(),function(e){},function(){n(),e()})},l||1e4)}(100)},u.refresh=function(e,l,a){getAllAlarms(e,function(e){var l,a="";$.each(e,function(e,l){a+='<li class="bui-btn bui-box" href="pages/main/detailalarm.html?Area='.concat(l.Area,"&Station=").concat(l.Station,"&Device=").concat(l.Device,"&Signal=").concat(l.Signal,"&SignalID=").concat(l.SignalID,"&AlarmLevel=").concat(l.AlarmLevel,"&AlarmDesc=").concat(l.AlarmDesc,"&StartTime=").concat(l.StartTime,"&EndTime=").concat(l.EndTime||"","&ConfirmTime=").concat(l.ConfirmTime||"","&Confirmer=").concat(l.Confirmer||"","&StartValue=").concat(l.StartValue,"&EndValue=").concat(l.EndValue||"",'">\n              <div class="alarm-icon ').concat(getAlarmCls1(l.AlarmLevel),'"><i class="appiconfont appicon-bell"></i></div>\n              <div class="span1">\n                  <div class="bui-box item-title-box">\n                      <div class="span1 item-title">').concat(l.Signal,'</div>\n                      <div class="item-text item-sub-title ').concat(getAlarmCls1(l.AlarmLevel),'">').concat(getAlarmName(l.AlarmLevel),'</div>\n                  </div>\n                  <div class="bui-box item-text-box">\n                      <div class="span1 item-text">\n                          <span class="item-value">').concat(l.Device,'</span> \n                      </div>\n                      <div class="item-text">\n                          <span class="item-time">').concat(l.StartTime,'</span>\n                      </div>\n                  </div>\n              </div>\n              <i class="icon-listright"></i>\n          </li>')}),!1===isNullOrEmpty(a,!0)?(l=a,router.$("#pylon-app-alarm-list").html(l),router.$(".overlist .bui-scroll-foot").html('<div class="nomore">没有更多内容</div>')):i()},function(e){i(),l(e)},a)},u.dispose=function(){n(),t()},u.condition=function(e){this.options=$.extend({area:null,station:null,device:null,signal:null,level:[]},e||{})},u.init(),u});
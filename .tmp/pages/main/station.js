"use strict";loader.define(function(){var n={name:"站点详情",params:null,request:null,maintab:null,search:null,refkeys:null,station:null,devices:null};function a(t){var i=router.$("#pylon-app-device-list");if(0===t.length)return n.refkeys=[],void i.html('<div class="nodata"><i class="appiconfont appicon-empty-face"></i> <span>列表空空如也~</span></div>');var e=[],a='<ul class="bui-list detail-list">';$.each(t,function(t,i){e.push(i.ID),a+='\n          <li id="pylon-data-device-'.concat(i.ID,'" class="bui-btn bui-box" href="pages/main/device.html?id=').concat(i.ID,'">\n            <div class="bui-icon round success"><i class="appiconfont appicon-server"></i></div>\n            <div class="span1">').concat(i.Name,' <span class="bui-badges hidden">0</span></div>\n            <i class="icon-listright"></i>\n          </li>\n          ')}),a+='</ul><div class="nomore">没有更多内容</div>',n.refkeys=e,i.html(a)}return n.init=function(){var t,i;!0===isNull(this.params)&&(this.params=router.getPageParams(),router.$("#pylon-app-station-webcam").attr("href",String.format("pages/main/webcam.html?id={0}",this.params.id))),!0===isNull(this.request)&&(this.request=getAppRequest()),!0===isNull(this.maintab)&&(this.maintab=bui.tab({id:"#pylon-app-station-tab",swipe:!1,scroll:!0})),!0===isNull(this.search)&&(this.search=bui.searchbar({id:"#pylon-app-device-search",onInput:function(){},onRemove:function(t,i){n.filter(i)},callback:function(t,i){n.filter(i)}})),t=router.$("#pylon-app-station-detail li.overlist"),i=router.$("#pylon-app-device-search"),router.$("#pylon-app-device-list").height(t.height()-i.height())},n.load=function(){var t=n.params.id;$.when(getStationTask(t),getXDevicesByPidTask(t)).done(function(t,i){var e;!1===isNull(t)&&(n.station=t,e=t,router.$("#pylon-app-station-base-id").html(e.ID),router.$("#pylon-app-station-base-name").html(e.Name),router.$("#pylon-app-station-base-type").html(e.Type),router.$("#pylon-app-station-base-lonlat").html(e.Longitude+","+e.Latitude),router.$("#pylon-app-station-base-mid").html(e.MID)),!1===isNull(i)&&(a(n.devices=i),n.refresh())}).fail(function(t){warning(t)})},n.dispose=function(){},n.refresh=function(){!0!==isNull(this.refkeys)&&0!==this.refkeys.length&&this.request.Post({url:"GetNodeStates",data:{id:this.refkeys}},function(t){$.each(t.data,function(t,i){var e=router.$(String.format("#pylon-data-device-{0}",i.ID)),a=e.children(".bui-icon"),n=e.find(".span1 > .bui-badges");a.attr("class",String.format("bui-icon round {0}",getStateCls2(i.State))),n.html(i.AlarmCount),0<i.AlarmCount?n.show():n.hide()})},function(t){warning(t)})},n.filter=function(i){var t=this.devices;!1===isNullOrEmpty(i,!0)&&(i=i.toLowerCase(),t=t.filter(function(t){return-1<t.Name.toLowerCase().indexOf(i)})),a(t),this.refresh()},n.init(),n.load(),n});
"use strict";loader.define(function(e,l,a){var u={name:"历史告警",request:null,loading:null,deviceer:null,deviceor:null,signaler:null,leveler:null,starter:null,ender:null,submit:null,options:null};function o(e){!0!==isNull(e)?(u.loading.show(),getAllSignalsByPid(e,null,function(e){t(e)},function(e){warning(e.message)},function(){u.loading.hide()})):t([])}function t(e){var a=[],t=[];$.each(e,function(e,l){l.Type!==$node.AI.id&&l.Type!==$node.DI.id||(t.push(l),a.push({name:l.Name,value:l.ID}))}),u.nodes=t,u.signaler.option("data",a),u.signaler.selectNone()}function n(e){var a=[],l=u.signaler.values();if(0<l.length)$.each(l,function(e,l){a.push(parseInt(l.value))});else{var t=u.signaler.allValues();$.each(t,function(e,l){a.push(parseInt(l.value))})}if(0===a.length)return warning("无效的设备~"),e.stop(),!1;var n=null,i=u.leveler.values();0<i.length&&(n=[],$.each(i,function(e,l){n.push(parseInt(l.value))}));var r=u.starter.value(),s=u.ender.value();return!0===isNullOrEmpty(r)?(warning("请选择开始时间"),e.stop(),!1):!0===isNullOrEmpty(s)?(warning("请选择结束时间"),e.stop(),!1):(u.options={ids:a,levels:n,begin:r,end:s},e.stop(),void router.load({url:"pages/main/alarmlist.html"}))}return u.init=function(){!0===isNull(this.request)&&(this.request=getAppRequest()),!0===isNull(this.loading)&&(this.loading=bui.loading({appendTo:".alarmreport-page",text:"正在加载"})),!0===isNull(this.deviceer)&&(u.loading.show(),getXDevices(null,function(e){!function(e){if(getAppAuthType()===$ssh.Station){for(var l=getStations(),t=[],n={},a=0;a<l.length;a++){var i=l[a];n[i.ID]={d:i.ID,n:i.Name,c:[]}}$.each(e,function(e,l){var a=n[l.PID];a&&a.c.push({d:l.ID,n:l.Name})}),$.each(l,function(e,l){var a=n[l.ID];a&&t.push(a)}),router.$("#pylon-app-alarmreport-deviceer .selector").html('<div class="selected-val"></div><div class="selected-val"></div>'),u.deviceer=bui.levelselect({data:t,title:"筛选范围",trigger:"#pylon-app-alarmreport-deviceer .selected-val",level:2,field:{name:"n",value:"d",data:["c","a"]}})}else{var r=getAreas(),s=(l=getStations(),t=[],{});for(n={},a=0;a<r.length;a++){i=r[a];s[i.ID]={d:i.ID,n:i.Name,c:[]}}for(a=0;a<l.length;a++){i=l[a];n[i.ID]={d:i.ID,n:i.Name,c:[]}}$.each(e,function(e,l){var a=n[l.PID];a&&a.c.push({d:l.ID,n:l.Name})}),$.each(l,function(e,l){var a=s[l.PID];a&&a.c.push(n[l.ID])}),$.each(r,function(e,l){var a=s[l.ID];a&&t.push(a)}),router.$("#pylon-app-alarmreport-deviceer .selector").html('<div class="selected-val"></div><div class="selected-val"></div><div class="selected-val"></div>'),u.deviceer=bui.levelselect({data:t,title:"筛选范围",trigger:"#pylon-app-alarmreport-deviceer .selected-val",level:3,field:{name:"n",value:"d",data:["c","a"]}})}!1===isNull(u.deviceer)&&u.deviceer.on("lastchange",function(e,l,a){var t,n=this.value();if(getAppAuthType()===$ssh.Station){if(2<=n.length&&-1!=(t=parseInt(n[1].value)))return o(t),!0}else if(3<=n.length&&-1!=(t=parseInt(n[2].value)))return o(t),!0;o()})}(e)},function(e){warning(e.message)},function(){u.loading.hide()})),!0===isNull(this.deviceor)&&(this.deviceor=router.$("#pylon-app-alarmreport-deviceer"),this.deviceor.on("click",function(){u.deviceer.show()})),!0===isNull(this.signaler)&&(this.signaler=bui.select({trigger:"#pylon-app-alarmreport-signal",title:"信号列表",type:"checkbox",height:"60%",data:[],placeholder:"全部信号",buttons:[{name:"重置",className:""},{name:"确定",className:"primary-reverse"}],callback:function(e){"重置"==$(e.target).text()?u.signaler.selectNone():u.signaler.hide()}})),!0===isNull(this.leveler)&&(this.leveler=bui.select({trigger:"#pylon-app-alarmreport-level",title:"告警等级",type:"checkbox",height:"60%",data:[{name:"一级告警",value:1},{name:"二级告警",value:2},{name:"三级告警",value:3},{name:"四级告警",value:4}],placeholder:"全部告警",buttons:[{name:"重置",className:""},{name:"确定",className:"primary-reverse"}],callback:function(e){"重置"==$(e.target).text()?u.leveler.selectNone():u.leveler.hide()}})),!0===isNull(this.starter)&&(this.starter=bui.pickerdate({bindValue:!0,handle:"#pylon-app-alarmreport-start",formatValue:"yyyy-MM-dd hh:mm:ss",value:bui.date.format(new Date,"yyyy-MM-dd")})),!0===isNull(this.ender)&&(this.ender=bui.pickerdate({bindValue:!0,handle:"#pylon-app-alarmreport-end",formatValue:"yyyy-MM-dd hh:mm:ss",value:new Date})),!0===isNull(this.submit)&&(this.submit=bui.btn("#pylon-app-alarmreport-ok"),this.submit.submit(n,{text:"正在查询..."}))},u.load=function(){},u.dispose=function(){},u.getoptions=function(){return this.options},u.init(),u});
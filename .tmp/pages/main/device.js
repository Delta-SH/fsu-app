"use strict";loader.define(function(){var u={name:"设备信号",params:null,loading:null,request:null,maintab:null,dropdown:null,timer:null,device:null,nodes:null,xnodes:null,xkeys:null,search:null,pull:null,view:null,aodialog:null,aosignal:null,aoadjust:null,aounit:null,dodialog:null,amdialog:null,amparam:null,amalarm:null,amtriger:null,amstart:null,amend:null};function e(){!1===isNull(u.timer)&&(clearTimeout(u.timer),u.timer=null)}function n(i){var a=u.nodes,e=parseInt(u.dropdown.value()),n=[],l=[];i=!1===isNullOrEmpty(i,!0)?i.toLowerCase():null,$.each(a,function(a,t){if(t.Type===e){if(!1===isNull(i)&&-1===t.Name.toLowerCase().indexOf(i))return!0;n.push(t),l.push(t.ID)}}),u.xnodes=n,u.xkeys=l,e===$node.DI.id?function(a){var t=router.$("#pylon-app-node-scroll > .bui-scroll-foot"),i=router.$("#pylon-app-node-listview");if(0===a.length)return i.html(""),t.html('<div class="nodata"><i class="appiconfont appicon-empty-face"></i> <span>列表空空如也~</span></div>');var e="";$.each(a,function(a,t){e+='<li id="pylon-data-signal-'.concat(t.ID,'" status="1" data-id="').concat(t.ID,'" data-type="').concat(t.Type,'" data-desc="').concat(t.ValueDesc,'">\n                <div class="bui-btn bui-box item-box">\n                    <div class="signal-icon ').concat(getStateCls1(t.State),'"><i class="appiconfont appicon-signal"></i></div>\n                    <div class="span1">\n                        <div class="bui-box item-title-box">\n                            <div class="span1 item-title">').concat(t.Name,'</div>\n                            <div class="item-text item-sub-title ').concat(getStateCls1(t.State),'">').concat(getStateName(t.State),'</div>\n                        </div>\n                        <div class="bui-box item-text-box">\n                            <div class="span1 item-text">\n                                <span class="item-value">').concat(getNodeValue(t.Type,t.Value,t.ValueDesc),'</span> \n                            </div>\n                            <div class="item-text">\n                                <span class="item-time">').concat(t.Time,"</span>\n                            </div>\n                        </div>\n                    </div>\n                </div>"),0==isNull(t.AlarmSets)&&0<t.AlarmSets.length&&(e+='<div class="bui-listview-menu swipeleft"><div class="bui-btn danger" data-id="'.concat(t.ID,'" data-type="').concat(t.Type,'">告警设定</div></div>')),e+="</li>"}),i.html(e),t.html('<div class="nomore">没有更多内容</div>')}(n):e===$node.AI.id?function(a){var t=router.$("#pylon-app-node-scroll > .bui-scroll-foot"),i=router.$("#pylon-app-node-listview");if(0===a.length)return i.html(""),t.html('<div class="nodata"><i class="appiconfont appicon-empty-face"></i> <span>列表空空如也~</span></div>');var e="";$.each(a,function(a,t){e+='<li id="pylon-data-signal-'.concat(t.ID,'" status="1" data-id="').concat(t.ID,'" data-type="').concat(t.Type,'" data-desc="').concat(t.ValueDesc,'">\n                <div class="bui-btn bui-box item-box">\n                    <div class="signal-icon ').concat(getStateCls1(t.State),'"><i class="appiconfont appicon-signal3"></i></div>\n                    <div class="span1">\n                        <div class="bui-box item-title-box">\n                            <div class="span1 item-title">').concat(t.Name,'</div>\n                            <div class="item-text item-sub-title ').concat(getStateCls1(t.State),'">').concat(getStateName(t.State),'</div>\n                        </div>\n                        <div class="bui-box item-text-box">\n                            <div class="span1 item-text">\n                                <span class="item-value">').concat(getNodeValue(t.Type,t.Value,t.ValueDesc),'</span> \n                            </div>\n                            <div class="item-text">\n                                <span class="item-time">').concat(t.Time,"</span>\n                            </div>\n                        </div>\n                    </div>\n                </div>"),0==isNull(t.AlarmSets)&&0<t.AlarmSets.length&&(e+='<div class="bui-listview-menu swipeleft"><div class="bui-btn danger" data-id="'.concat(t.ID,'" data-type="').concat(t.Type,'">告警设定</div></div>')),e+="</li>"}),i.html(e),t.html('<div class="nomore">没有更多内容</div>')}(n):e===$node.AO.id?function(a){var t=router.$("#pylon-app-node-scroll > .bui-scroll-foot"),i=router.$("#pylon-app-node-listview");if(0===a.length)return i.html(""),t.html('<div class="nodata"><i class="appiconfont appicon-empty-face"></i> <span>列表空空如也~</span></div>');var e="";$.each(a,function(a,t){e+='<li id="pylon-data-signal-'.concat(t.ID,'" status="1" data-id="').concat(t.ID,'" data-type="').concat(t.Type,'" data-desc="').concat(t.ValueDesc,'">\n                <div class="bui-btn bui-box item-box">\n                    <div class="signal-icon ').concat(getStateCls1(t.State),'"><i class="appiconfont appicon-wifi"></i></div>\n                    <div class="span1">\n                        <div class="bui-box item-title-box">\n                            <div class="span1 item-title">').concat(t.Name,'</div>\n                            <div class="item-text item-sub-title ').concat(getStateCls1(t.State),'">').concat(getStateName(t.State),'</div>\n                        </div>\n                        <div class="bui-box item-text-box">\n                            <div class="span1 item-text">\n                                <span class="item-value">').concat(getNodeValue(t.Type,t.Value,t.ValueDesc),'</span> \n                            </div>\n                            <div class="item-text">\n                                <span class="item-time">').concat(t.Time,'</span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <div class="bui-listview-menu swipeleft"><div class="bui-btn primary"  data-id="').concat(t.ID,'" data-type="').concat(t.Type,'">远程设定</div></div></li>\n                </li>')}),i.html(e),t.html('<div class="nomore">没有更多内容</div>')}(n):e===$node.DO.id?function(a){var t=router.$("#pylon-app-node-scroll > .bui-scroll-foot"),i=router.$("#pylon-app-node-listview");if(0===a.length)return i.html(""),t.html('<div class="nodata"><i class="appiconfont appicon-empty-face"></i> <span>列表空空如也~</span></div>');var e="";$.each(a,function(a,t){e+='<li id="pylon-data-signal-'.concat(t.ID,'" status="1" data-id="').concat(t.ID,'" data-type="').concat(t.Type,'" data-desc="').concat(t.ValueDesc,'">\n                <div class="bui-btn bui-box item-box">\n                    <div class="signal-icon ').concat(getStateCls1(t.State),'"><i class="appiconfont appicon-wifi"></i></div>\n                    <div class="span1">\n                        <div class="bui-box item-title-box">\n                            <div class="span1 item-title">').concat(t.Name,'</div>\n                            <div class="item-text item-sub-title ').concat(getStateCls1(t.State),'">').concat(getStateName(t.State),'</div>\n                        </div>\n                        <div class="bui-box item-text-box">\n                            <div class="span1 item-text">\n                                <span class="item-value">').concat(getNodeValue(t.Type,t.Value,t.ValueDesc),'</span> \n                            </div>\n                            <div class="item-text">\n                                <span class="item-time">').concat(t.Time,'</span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <div class="bui-listview-menu swipeleft"><div class="bui-btn primary" data-id="').concat(t.ID,'" data-type="').concat(t.Type,'">远程控制</div></div></li>\n                </li>')}),i.html(e),t.html('<div class="nomore">没有更多内容</div>')}(n):e===$node.CI.id?function(a){var t=router.$("#pylon-app-node-scroll > .bui-scroll-foot"),i=router.$("#pylon-app-node-listview");if(0===a.length)return i.html(""),t.html('<div class="nodata"><i class="appiconfont appicon-empty-face"></i> <span>列表空空如也~</span></div>');var e="";$.each(a,function(a,t){e+='<li id="pylon-data-signal-'.concat(t.ID,'" status="1" data-id="').concat(t.ID,'" data-type="').concat(t.Type,'" data-desc="').concat(t.ValueDesc,'">\n                <div class="bui-btn bui-box item-box">\n                    <div class="signal-icon ').concat(getStateCls1(t.State),'"><i class="appiconfont appicon-signal2"></i></div>\n                    <div class="span1">\n                        <div class="bui-box item-title-box">\n                            <div class="span1 item-title">').concat(t.Name,'</div>\n                            <div class="item-text item-sub-title ').concat(getStateCls1(t.State),'">').concat(getStateName(t.State),'</div>\n                        </div>\n                        <div class="bui-box item-text-box">\n                            <div class="span1 item-text">\n                                <span class="item-value">').concat(getNodeValue(t.Type,t.Value,t.ValueDesc),'</span> \n                            </div>\n                            <div class="item-text">\n                                <span class="item-time">').concat(t.Time,'</span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <div class="bui-listview-menu swipeleft"><div class="bui-btn danger" data-id="').concat(t.ID,'" data-type="').concat(t.Type,'">复位</div></div>\n                </li>')}),i.html(e),t.html('<div class="nomore">没有更多内容</div>')}(n):e===$node.SI.id&&function(a){var t=router.$("#pylon-app-node-scroll > .bui-scroll-foot"),i=router.$("#pylon-app-node-listview");if(0===a.length)return i.html(""),t.html('<div class="nodata"><i class="appiconfont appicon-empty-face"></i> <span>列表空空如也~</span></div>');var e="";$.each(a,function(a,t){e+='<li id="pylon-data-signal-'.concat(t.ID,'" status="1" data-id="').concat(t.ID,'" data-type="').concat(t.Type,'" data-desc="').concat(t.ValueDesc,'">\n                <div class="bui-btn bui-box item-box">\n                    <div class="signal-icon ').concat(getStateCls1(t.State),'"><i class="appiconfont appicon-signal"></i></div>\n                    <div class="span1">\n                        <div class="bui-box item-title-box">\n                            <div class="span1 item-title">').concat(t.Name,'</div>\n                            <div class="item-text item-sub-title ').concat(getStateCls1(t.State),'">').concat(getStateName(t.State),'</div>\n                        </div>\n                        <div class="bui-box item-text-box">\n                            <div class="span1 item-text">\n                                <span class="item-value">').concat(getNodeValue(t.Type,t.Value,t.ValueDesc),'</span> \n                            </div>\n                            <div class="item-text">\n                                <span class="item-time">').concat(t.Time,"</span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                </li>")}),i.html(e),t.html('<div class="nomore">没有更多内容</div>')}(n)}function m(a){u.amalarm.value(a.Level.toString()),u.amtriger.value(a.TriggerMode.toString()),u.amstart.val(a.Threshold),u.amend.val(a.BandThreshold)}function v(a,t){var i=0;!1===isNullOrEmpty(t)&&(i=parseFloat(t)),u.loading.show(),u.request.Post({url:"SetSignalValue",timeout:1e4,data:{id:a,value:i}},function(a){successdialog(a.msg)},function(a){warningdialog("执行失败",a.message)},function(){u.loading.hide()})}return u.init=function(){!0===isNull(this.params)&&(this.params=router.getPageParams()),!0===isNull(this.loading)&&(this.loading=bui.loading({appendTo:".device-page",text:"正在执行"})),!0===isNull(this.request)&&(this.request=getAppRequest()),!0===isNull(this.maintab)&&(this.maintab=bui.tab({id:"#pylon-app-device-tab",swipe:!1,scroll:!0})),!0===isNull(this.dropdown)&&(this.dropdown=bui.dropdown({id:"#pylon-data-signal-dropdown",data:[{name:$node.DI.name,value:$node.DI.id.toString()},{name:$node.AI.name,value:$node.AI.id.toString()},{name:$node.DO.name,value:$node.DO.id.toString()},{name:$node.AO.name,value:$node.AO.id.toString()},{name:$node.CI.name,value:$node.CI.id.toString()},{name:$node.SI.name,value:$node.SI.id.toString()}],showArrow:!0,showActive:!0,relative:!1,value:$node.DI.name,callback:function(){n(),u.refresh()}})),!0===isNull(this.pull)&&(this.search=bui.searchbar({id:"#pylon-app-node-search",onInput:function(){},onRemove:function(a,t){n(t),u.refresh()},callback:function(a,t){n(t),u.refresh()}}),this.pull=bui.pullrefresh({id:"#pylon-app-node-scroll",autoLoad:!1,onRefresh:function(){u.refresh(function(){u.pull.reverse()})}}),this.view=bui.listview({id:"#pylon-app-node-listview",callback:function(a,t){var i,e,n,l,s,o=router.$(a.target),c=parseInt(o.attr("data-id")),d=parseInt(o.attr("data-type")),p=u.xnodes.filter(function(a){return a.ID===c});if(0<p.length){var r=p[0];d===$node.DI.id||d===$node.AI.id?(n=r,l=[],s={},$.each(n.AlarmSets,function(a,t){s[a.toString()]=$.extend({},t),l.push({name:"告警设定"+(a+1).toString(),value:a.toString()})}),u.amsignal.val(n.Name),u.amparam.option("data",l),u.amparam.map=s,u.amparam.current=s[0],u.amparam.active(0),m(u.amparam.current),u.amdialog.target=n,u.amdialog.open()):d===$node.AO.id?(e=r,u.aosignal.val(e.Name),u.aounit.html(e.ValueDesc),u.aoadjust.val(0),u.aodialog.target=e,u.aodialog.open()):d===$node.DO.id?function(a){var i=[];$.each(getUnits(a.ValueDesc),function(a,t){i.push({name:String.format("{0}-{1}",t.name,t.id),value:t.id})}),0===i.length&&(i.push({name:"常开控制-0",value:"0"}),i.push({name:"常闭控制-1",value:"1"}),i.push({name:"脉冲控制-4",value:"4"}));u.dosignal.val(a.Name),u.doption.option("data",i),u.doption.active(0),u.dodialog.target=a,u.dodialog.open()}(r):d===$node.CI.id&&(i=r,bui.confirm("您确定要复位吗?",function(a){"确定"==$(a.target).text()&&v(i.ID),this.close()}))}t.close(),a.stopPropagation()}})),!0===isNull(this.aodialog)&&(this.aodialog=bui.dialog({id:"#pylon-app-ao-dialog",effect:"fadeInUp",position:"bottom",fullscreen:!1,height:"60%",buttons:[],callback:function(a){var t=$(a.target),i=this;return"ok"===t.attr("data-cmd")?bui.confirm("您确定要执行吗?",function(a){"确定"==$(a.target).text()&&v(i.target.ID,u.aoadjust.val()),this.close()}):i.close(),!1}}),this.aosignal=router.$("pylon-app-data-ao-name"),this.aounit=router.$("pylon-app-ao-unit"),this.aoadjust=router.$("pylon-app-ao-adjust")),!0===isNull(this.dodialog)&&(this.dodialog=bui.dialog({id:"#pylon-app-do-dialog",effect:"fadeInUp",position:"bottom",fullscreen:!1,height:"60%",buttons:[],callback:function(a){var t=$(a.target),i=this;return"ok"===t.attr("data-cmd")?bui.confirm("您确定要执行吗?",function(a){"确定"==$(a.target).text()&&v(i.target.ID,u.doption.value()),this.close()}):i.close(),!1}}),this.dosignal=router.$("pylon-app-data-do-name"),this.doption=bui.select({id:"#pylon-app-data-do-option",type:"radio",popup:!1,direction:"right",data:[]})),!0===isNull(this.amdialog)&&(this.amdialog=bui.dialog({id:"#pylon-app-alarm-dialog",effect:"fadeInUp",position:"bottom",fullscreen:!1,height:"80%",buttons:[],callback:function(a){return"ok"===$(a.target).attr("data-cmd")?bui.confirm("您确定要执行吗?",function(a){var i,e,t;"确定"==$(a.target).text()&&(i=[],e=u.amparam.map,t=u.amdialog.target,$.each(Object.keys(e),function(a,t){i.push(e[t])}),u.loading.show(),u.request.Post({url:"SetSigAlarmSet",timeout:1e4,data:{id:t.ID,value:i}},function(a){t.AlarmSets=i,successdialog(a.msg)},function(a){warningdialog("执行失败",a.message)},function(){u.loading.hide()})),this.close()}):this.close(),!1}}),this.amsignal=router.$("pylon-app-data-signal-name"),this.amstart=router.$("pylon-app-data-threshold-start"),this.amend=router.$("pylon-app-data-threshold-end"),this.amstart.on("change",function(){if(!1===isNull(u.amparam.current)){var a=$(this).val();u.amparam.current.Threshold=!0===isNullOrEmpty(a,!0)?0:parseFloat(a)}}),this.amend.on("change",function(){if(!1===isNull(u.amparam.current)){var a=$(this).val();u.amparam.current.BandThreshold=!0===isNullOrEmpty(a,!0)?0:parseFloat(a)}}),this.amparam=bui.dropdown({id:"#pylon-app-data-param-num",data:[],showArrow:!0,showActive:!0,relative:!1,callback:function(){var a=parseInt(this.value());!1===isNull(this.map)&&m(this.current=this.map[a])}}),this.amalarm=bui.dropdown({id:"#pylon-app-data-alarm-level",showArrow:!0,showActive:!0,relative:!1,callback:function(){!1===isNull(u.amparam.current)&&(u.amparam.current.Level=parseInt(this.value()))}}),this.amtriger=bui.dropdown({id:"#pylon-app-data-trigger-model",showArrow:!0,showActive:!0,relative:!1,callback:function(){!1===isNull(u.amparam.current)&&(u.amparam.current.TriggerMode=parseInt(this.value()))}}))},u.load=function(){this.device=null,this.nodes=[],this.xnodes=[],this.xkeys=[];var a=u.params.id;$.when(getDeviceTask(a),getAllSignalsByPidTask(a)).done(function(a,t){var i;!1===isNull(a)&&(u.device=a,i=a,router.$("#pylon-app-device-base-id").html(i.ID),router.$("#pylon-app-device-base-name").html(i.Name),router.$("#pylon-app-device-base-type").html(i.Type),router.$("#pylon-app-device-base-model").html(i.Model),router.$("#pylon-app-device-base-brand").html(i.Brand),router.$("#pylon-app-device-base-capacity").html(i.RatedCapacity),router.$("#pylon-app-device-base-version").html(i.Version),router.$("#pylon-app-device-base-begin").html(i.BeginTime)),!1===isNull(t)&&(u.nodes=t,n(),function a(t){u.timer=setTimeout(function(){u.refresh(function(){e(),a()})},t||1e4)}(200))}).fail(function(a){warning(a)})},u.refresh=function(a){if(0===this.xkeys.length)return!0===isFunction(a)&&a(),!1;u.request.Post({url:"GetSignalDatas",data:{id:u.xkeys}},function(a){$.each(a.data,function(a,t){var i=router.$(String.format("#pylon-data-signal-{0}",t.ID)),e=parseInt(i.attr("data-type")),n=i.attr("data-desc"),l=i.find(".item-box > .signal-icon"),s=i.find(".item-box > .span1 > .item-title-box > .item-sub-title"),o=i.find(".item-box >.span1 > .item-text-box .item-value"),c=i.find(".item-box >.span1 > .item-text-box .item-time");l.attr("class",String.format("signal-icon {0}",getStateCls1(t.State))),s.attr("class",String.format("item-text item-sub-title {0}",getStateCls1(t.State))),s.html(getStateName(t.State)),o.html(getNodeValue(e,t.Value,n)),c.html(t.Time)})},function(a){},function(){!0===isFunction(a)&&a()})},u.dispose=function(){e()},u.init(),u.load(),u});